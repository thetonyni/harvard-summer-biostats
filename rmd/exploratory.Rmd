---
title: "Exploratory Analysis"
author: "Tony Ni, Antonella Basso, Jose Lopez"
date: "6/11/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Libraries
```{r, include = FALSE}
library(mdsr)
library(tidyverse)
library(ggplot2)
```

Goals:

comparing how upgradients look vs downgradients through a graph (make sure the average thing/wrangling to fix it)

pick a chemical of interest

histograms of concentrations (one for upgradient vs downgradient for a single site)

compare the compare the 2 powerplants overall (upgradient at one vs the other)

regression

## Reading in Data

```{r}
setwd("~/harvard-summer-biostats")
new_york <- read_csv("data/new_york.csv") #read in data
```

## Checking unique/distinct levels

```{r}
#check how many observations there
nrow(new_york)

#checking distincts sites
unique(new_york$site)

#checking distinct gradient
unique(new_york$gradient)

#checking distinct gradient
unique(new_york$measurement.unit)

#checking disposal area
unique(new_york$disposal.area)

#checking type (L = land fuel, SI = surface impoundement, M = mixed/multiunit)
#nelly asks what does type mean???
unique(new_york$type)

new_york %>%
  group_by(type) %>%
  summarize(n())

#ask if we might want to remove the other measurements for consistency?????
#nelly asks can we find a way to convert these easily!

new_york %>%
  group_by(measurement.unit) %>%
  summarize(n())

#checking wells
new_york %>%
  group_by(well.id) %>%
  summarize(n())
```

## Wrangling

```{r, warning = FALSE}
new_york1 <- new_york %>%
  select(site, disposal.area, type, well.id, gradient, contaminant, 
         measurement.unit, concentration) %>%
  mutate(well.id_contaminant = paste0(well.id, "_", contaminant)) %>% #for future use
  rename(c("disposal_area" = "disposal.area", "well_id" = "well.id",
           "unit" = "measurement.unit"))

#fixing 'contaminant' string by removing everything after the comma
new_york1$contaminant=gsub(", total", "", new_york1$contaminant)

#testing
avg_contaminant <- new_york1 %>%
  group_by(well_id, contaminant) %>% 
  summarise_each(funs(mean)) %>%
  select(1,2,8) #selecting only numeric columns

#temporarily uniting columns for joining in next step
temp <- avg_contaminant %>%
  unite("well.id_contaminant", well_id, contaminant)

#joining orig dataframe and avg_contaminant dataframe
combined <- left_join(temp, new_york1, by = "well.id_contaminant") %>%
  distinct(well.id_contaminant, .keep_all = TRUE) %>%
  separate(well.id_contaminant, c('well_id', 'contaminant'), sep="_") %>%
  select(1:8)

combined2 <- combined %>% #collapse empty rows
  spread(contaminant, concentration.x) %>%
  group_by(well_id) %>%
  summarise_each(funs(first(.[!is.na(.)]))) %>%
  select(-c(unit))
```



## Summary Statistics

```{r}
new_york %>%
  group_by(contaminant) %>%
  summarize()
```


```{r}
new_york %>%
  group_by(contaminant) %>%
  summarize(mean_concentration = mean(concentration))
```

## Visualizations

```{r}
#looking at one specific well and the contaminant concentrations within it

ggplot(data = combined %>%
         filter(well_id == "A-2"), aes(x = contaminant, y = concentration.x,
                                       fill = contaminant)) + 
  geom_bar(stat = "identity", show.legend = FALSE) + 
  xlab("Contaminant") +
  ylab("Concentration") +
  ggtitle("Concentration of Contaminants in Well A-2") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

#looking at one contaminant for all wells (counts)

ggplot(data = combined %>%
         filter(contaminant == "Antimony"), 
       aes(x = well_id, y = concentration.x, fill = well_id)) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  xlab("Well ID") +
  ylab("Concentration") +
  ggtitle("Concentration of Antimony across Wells") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```

